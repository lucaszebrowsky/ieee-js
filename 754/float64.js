// IEE754 Double Precision Floats (64bit Float)
// https://en.wikipedia.org/wiki/Double-precision_floating-point_format
function to_fp64(b0, b1, b2, b3, b4, b5, b6, b7) {
    const bias = 1023;

    // Note: Javascript Numbers are always stored as IEEE 754 64-Bit Floats,
    // so we need to handle them as 2 separate 32-Bit values instead
    const low = (b3 << 24) | (b2 << 16) | (b1 << 8) | b0;
    const high = (b7 << 24) | (b6 << 16) | (b5 << 8) | b4;

    const sign = (high >>> 31) & 0x1;
    const sign_multiplier = sign === 0 ? 1 : -1;
    const exponent = (high >>> 20) & 0x7ff;
    const fraction = (high & 0xfffff) * Math.pow(2, 32) + (low >>> 0);

    if (exponent === 0) {
        if (fraction === 0) {
            return sign_multiplier * 0;
        }
        return (
            sign_multiplier * Math.pow(2, -1022) * (fraction / Math.pow(2, 52))
        );
    }

    if (exponent === 0x7ff) {
        return fraction === 0 ? sign_multiplier * Infinity : NaN;
    }

    const mantissa = 1 + fraction / Math.pow(2, 52);
    return sign_multiplier * mantissa * Math.pow(2, exponent - bias);
}

// Values taken from:
// https://en.wikipedia.org/wiki/Double-precision_floating-point_format#Double-precision_examples
console.log("--- Float64 Begin ---");
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f)); // 1
console.log(to_fp64(0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f)); // ≈ 1.0000000000000002220
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40)); // 2
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0)); // - 2
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x40)); // 3
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x40)); // 4
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x40)); // 5
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x40)); // 6
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x40)); // 23
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x3f)); // 0.01171875 (3/256)
console.log(to_fp64(0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00)); // ≈ 4.9406564584124654 × 10−324
console.log(to_fp64(0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00)); // ≈ 2.2250738585072014 × 10−308
console.log(to_fp64(0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xef, 0x7f)); // ≈ 1.7976931348623157 × 10308
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00)); // +0
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80)); // +0
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f)); // + Infinity
console.log(to_fp64(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff)); // - Infinity
console.log(to_fp64(0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f)); // sNAN
console.log(to_fp64(0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x7f)); // qNAN
console.log(to_fp64(0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f)); // NAN
console.log(to_fp64(0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0xd5, 0x3f)); // ≈ 0.33333333333333331483
console.log(to_fp64(0x18, 0x2d, 0x44, 0x54, 0xfb, 0x21, 0x09, 0x40)); // ≈ 3.141592653589793116
console.log("--- Float64 End ---");
